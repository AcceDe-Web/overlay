/**
 * @accedeweb/modal - WAI-ARIA modal plugin based on AcceDe Web instructions
 * @version v0.0.0
 * @link http://a11y.switch.paris/
 * @license ISC
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Modal=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, [tabindex], [contentEditable]",i={set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,i=arguments[1];if(!e.disabledElements){var n=[],o=[];Array.prototype.forEach.call(e.querySelectorAll(t),function(e){if(!(i&&i.contains(e)||e.closest("[hidden]"))){var t=parseInt(e.getAttribute("tabindex"),10);if(t){if(t<0)return;e.defaultTabindex=t}n.push(e),e.setAttribute("tabindex","-1")}}),e.disabledElements=n.length?n:null,i?Array.prototype.forEach.call(i.parentNode.children,function(e){if("SCRIPT"!==e.nodeName&&e!==i){var t=e.getAttribute("aria-hidden");if(t){if("true"===t)return;e.defaultAriaHidden=t}e.setAttribute("aria-hidden","true"),o.push(e)}}):(e.setAttribute("aria-hidden","true"),o.push(e)),e.hiddenElements=o.length?o:null}},unset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,i=e.disabledElements||Array.prototype.slice.call(e.querySelectorAll(t)),n=e.hiddenElements||[e];i.forEach(function(e){var t=e.defaultTabindex;t?(e.setAttribute("tabindex",t),e.defaultTabindex=null):e.removeAttribute("tabindex")}),e.disabledElements=null,n.forEach(function(e){var t=e.defaultAriaHidden;t?(e.setAttribute("aria-hidden",t),e.defaultAriaHidden=null):e.removeAttribute("aria-hidden")}),e.hiddenElements=null},focusables:t},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=["hide","show"],l=0,a=0;return function(){function t(i,o){if(e(this,t),this.listeners={keydown:this._handleKeydown.bind(this),click:this._handleClick.bind(this),close:this._handleClose.bind(this)},this.callbacks={},o=arguments[1]||"object"===n(arguments[0])?arguments[0]:{},!(i=o!==arguments[0]?arguments[0]:void 0)&&!o)throw new Error("No parameter passed.");o.modal||(o.modal=!0),this.options=o,this._init(i)}return o(t,null,[{key:"modalCount",get:function(){return a},set:function(e){a=e}},{key:"modalIndex",get:function(){return l},set:function(e){l=e}}]),o(t,[{key:"_bind",value:function(){var e=this;this.el.addEventListener("keydown",this.listeners.keydown,!0),this.el.addEventListener("click",this.listeners.click),this.el.closeBtns&&this.el.closeBtns.forEach(function(t){t.addEventListener("click",e.listeners.close)})}},{key:"_createDom",value:function(){var e=document.createElement(this.options.tagName||"div");if(this.options.className&&(e.className+=this.options.className),e.setAttribute("aria-hidden","true"),this.options.modal&&e.setAttribute("aria-modal","true"),this.options.dom&&("string"==typeof this.options.dom?e.innerHTML=this.options.dom:e.appendChild(this.options.dom)),this.options.label&&e.setAttribute("aria-label",this.options.label),this.options.role){e.setAttribute("role",this.options.role);var i=t.modalIndex;if(!this.options.label&&!e.hasAttribute("aria-labelledby")&&!e.hasAttribute("aria-label")){var n=e.querySelector(this.options.titleSelector||"[data-label]"),o=void 0;n&&(o=n.id||"modalTitle"+i,n.id=o,e.setAttribute("aria-labelledby",o))}if(!e.hasAttribute("aria-describedby")){var s=e.querySelector("[data-description]"),l=void 0;s&&(l=s.id||"modalDescription"+i,s.id=l,e.setAttribute("aria-describedby",l))}}return e}},{key:"_disableDocument",value:function(){this.documentDisabled=!0,i.set(document.body,this.el)}},{key:"_enableDocument",value:function(){i.unset(document.body),this.documentDisabled=!1}},{key:"_enableModal",value:function(){i.unset(this.el)}},{key:"_setInteractiveElement",value:function(){var e=this;if(this.el.firstInteractiveElement=this.el.querySelector("[autofocus]"),!this.el.firstInteractiveElement){var t=window.innerHeight;if(Array.prototype.some.call(this.el.querySelectorAll(i.focusables),function(i){var n=void 0;e.el.closeBtns&&e.el.closeBtns.indexOf(i)>-1&&(n=i);var o=i.offsetHeight;return!(!(i.offsetTop+o<=t&&(i.offsetWidth||i.offsetHeight))||n)&&(e.el.firstInteractiveElement=i,!0)}),!this.el.firstInteractiveElement){if(!this.el.firstInteractiveElement&&this.el.closeBtns){var n=this.el.closeBtns[0],o=n.offsetHeight;if(n.offsetTop+o<=t)return void(this.el.firstInteractiveElement=n)}Array.prototype.some.call(this.el.querySelectorAll("h1, h2, h3, h4, h5, h6, p, ul, dl, figure, img, table, canvas, detail"),function(t){return!(!t.offsetWidth&&!t.offsetHeight)&&(t.setAttribute("tabindex","-1"),e.el.firstInteractiveElement=t,!0)})}}}},{key:"_focus",value:function(){var e=this;this.el.firstInteractiveElement||this._setInteractiveElement(),window.requestAnimationFrame(function(){e.el.firstInteractiveElement.focus()})}},{key:"_handleClick",value:function(e){!1!==this.options.closeOnCancel&&e.target===this.el&&this._handleClose(e,"cancel")}},{key:"_handleClose",value:function(e,i){"alertdialog"===this.options.role&&"cancel"===i||(this._unbind(),this._trigger("hide",i),this.el.setAttribute("aria-hidden","true"),this.options.modal&&1===t.modalCount&&this._enableDocument(),t.modalCount--,this.options.opener.focus())}},{key:"_handleKeydown",value:function(e){return 27===e.keyCode&&!1!==this.options.closeOnCancel&&(this._handleClose(e,"cancel"),!0)}},{key:"hide",value:function(){this._handleClose({type:"user"})}},{key:"_init",value:function(e){return t.modalIndex++,this.el=e?this._initDom(e):this._createDom(),this.el.modal=this,this.options.closeSelector&&(this.el.closeBtns=Array.prototype.slice.call(this.el.querySelectorAll(this.options.closeSelector)),this.el.closeBtns.length||delete this.el.closeBtns),this.options.role&&this._validateModal(),this.el.parentNode!==document.body&&document.body.appendChild(this.el),this}},{key:"_initDom",value:function(e){return this.options.role=e.getAttribute("role"),this.options.modal&&e.setAttribute("aria-modal","true"),e}},{key:"off",value:function(e,t){if(this.callbacks[e]){var i=this.callbacks[e].indexOf(t);i<0||this.callbacks[e].splice(i,1)}}},{key:"on",value:function(e,t){s.indexOf(e)<0||(this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t))}},{key:"show",value:function(){t.modalCount++,this._bind(),this.options.opener=this.options.opener||document.activeElement,"svg"===this.options.opener.nodeName&&(this.options.opener=this.options.opener.parentNode),this._trigger("show"),"false"!==this.el.getAttribute("aria-hidden")&&this.el.setAttribute("aria-hidden","false"),this._focus(),1===t.modalCount&&this.options.modal&&!this.documentDisabled?this._disableDocument():this.documentDisabled&&this.options.dom&&this._enableModal()}},{key:"_trigger",value:function(e,t){var i=this;this.callbacks[e]&&this.callbacks[e].forEach(function(e){e(i,t)})}},{key:"_unbind",value:function(){var e=this;this.el.removeEventListener("keydown",this.listeners.keydown,!0),this.el.removeEventListener("click",this.listeners.click),this.el.closeBtns&&this.el.closeBtns.forEach(function(t){t.removeEventListener("click",e.listeners.close)})}},{key:"_validateModal",value:function(){var e=this.el.getAttribute("aria-label"),t=this.el.getAttribute("aria-describedby"),i=void 0;if((!e||e&&e.trim().length<0)&&(!(i=this.el.querySelector("#"+this.el.getAttribute("aria-labelledby")))||!this.el.contains(i)))throw new Error('No title is present in the modal. Use the "data-label" attribute on the visible title or pass the label using the "label" key when showing the modal.');if("alertdialog"===this.options.role&&!t)throw new Error('"alertdialog" modal needs a description, use the "data-description" attribute on the text content of the modal to validate the modal.')}}]),t}()});
