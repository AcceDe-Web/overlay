/**
 * @accede-web/overlay - WAI-ARIA overlay plugin based on AcceDe Web instructions
 * @version v1.1.0
 * @link http://a11y.switch.paris/
 * @license ISC
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Overlay=t()}(this,function(){"use strict";var l="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, [tabindex], [contentEditable]";var e={set:function(){var i,n,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,o=arguments[1];e.disabledElements||(i=[],n=[],Array.prototype.forEach.call(e.querySelectorAll(l),function(e){if(!(o&&o.contains(e)||e.closest("[hidden]"))){var t=parseInt(e.getAttribute("tabindex"),10);if(t){if(t<0)return;e.defaultTabindex=t}i.push(e),e.setAttribute("tabindex","-1")}}),e.disabledElements=i.length?i:null,o?Array.prototype.forEach.call(o.parentNode.children,function(e){if("SCRIPT"!==e.nodeName&&e!==o){var t=e.getAttribute("aria-hidden");if(t){if("true"===t)return;e.defaultAriaHidden=t}e.setAttribute("aria-hidden","true"),n.push(e)}}):(e.setAttribute("aria-hidden","true"),n.push(e)),e.hiddenElements=n.length?n:null)},unset:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,t=e.disabledElements||Array.prototype.slice.call(e.querySelectorAll(l)),i=e.hiddenElements||[e];t.forEach(function(e){var t=e.defaultTabindex;t?(e.setAttribute("tabindex",t),e.defaultTabindex=null):e.removeAttribute("tabindex")}),e.disabledElements=null,i.forEach(function(e){var t=e.defaultAriaHidden;t?(e.setAttribute("aria-hidden",t),e.defaultAriaHidden=null):e.removeAttribute("aria-hidden")}),e.hiddenElements=null},focusables:l},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=0,s=[],a=void 0,t=(t(r,[{key:"addEventListener",value:function(){this.el.addEventListener.apply(this.el,arguments)}},{key:"returnValue",get:function(){return this.el.returnValue},set:function(e){"object"===(void 0===e?"undefined":o(e))?this.el.returnValue=JSON.stringify(e):this.el.returnValue=e.toString()}}],[{key:"layerIndex",get:function(){return i},set:function(e){i=e}},{key:"stack",get:function(){return s.slice()}}]),t(r,[{key:"_bind",value:function(){var t=this;this.el.addEventListener("click",this._handleClick),this.el.addEventListener("cancel",this._handleCancel),this.el.closeBtns&&this.el.closeBtns.forEach(function(e){e.addEventListener("click",t._handleClose)})}},{key:"_createDom",value:function(){var e,t,i,n=document.createElement(this.options.tagName||"div");return this.options.className&&(n.className+=this.options.className),n.setAttribute("aria-hidden","true"),this.options.modal&&n.setAttribute("aria-modal","true"),this.options.content&&("string"==typeof this.options.content?n.innerHTML=this.options.content:n.appendChild(this.options.content)),this.options.label&&n.setAttribute("aria-label",this.options.label),this.options.role&&(n.setAttribute("role",this.options.role),e=r.layerIndex,this.options.label||n.hasAttribute("aria-labelledby")||n.hasAttribute("aria-label")||(t=void 0,(i=n.querySelector(this.options.titleSelector||"[data-label]"))&&(t=i.id||"layerTitle"+e,i.id=t,n.setAttribute("aria-labelledby",t))),!n.hasAttribute("aria-describedby"))&&(i=void 0,t=n.querySelector("[data-description]"))&&(i=t.id||"layerDescription"+e,t.id=i,n.setAttribute("aria-describedby",i)),document.body.appendChild(n),n}},{key:"_disableDocument",value:function(){this.documentDisabled=!0,e.set(document.body,this.el)}},{key:"_dispatchEvent",value:function(e){e=new window.CustomEvent(e,{cancelable:"cancel"===e});this.el.dispatchEvent(e)}},{key:"_enableDocument",value:function(){e.unset(document.body),this.documentDisabled=!1}},{key:"_enableLayer",value:function(){e.unset(this.el)}},{key:"_setInteractiveElement",value:function(){var i,n=this;this.el.firstInteractiveElement=this.el.querySelector("[autofocus]"),this.el.firstInteractiveElement||(i=window.innerHeight,Array.prototype.some.call(this.el.querySelectorAll(e.focusables),function(e){var t=e.offsetHeight;return!!(e.offsetTop+t<=i&&(e.offsetWidth||e.offsetHeight))&&(n.el.firstInteractiveElement=e,!0)}),this.el.firstInteractiveElement)||Array.prototype.some.call(this.el.querySelectorAll("h1, h2, h3, h4, h5, h6, p, ul, dl, figure, img, table, canvas, detail"),function(e){return!(!e.offsetWidth&&!e.offsetHeight||(e.setAttribute("tabindex","-1"),n.el.firstInteractiveElement=e,0))})}},{key:"_focus",value:function(){var e=this;this.el.firstInteractiveElement||this._setInteractiveElement(),window.requestAnimationFrame(function(){e.el.firstInteractiveElement.focus()})}},{key:"_handleCancel",value:function(e){e.defaultPrevented||"alertdialog"===this.options.role||this._handleClose(e)}},{key:"_handleClick",value:function(e){!1===this.options.closeOnCancel||e.target!==this.el||e.target===this.el&&"alertdialog"===this.options.role||this._dispatchEvent("cancel")}},{key:"_handleClose",value:function(){this._unbind(),this.el.setAttribute("aria-hidden","true"),this._dispatchEvent("close"),this.options.modal&&1===s.length&&this._enableDocument(),s.splice(s.indexOf(this.el),1),this.options.opener.focus()}},{key:"close",value:function(e){e&&(this.el.returnValue=e),this._handleClose()}},{key:"_init",value:function(e){return r.layerIndex++,this.el=e?this._initDom(e):this._createDom(),(this.el.layer=this).el.returnValue="",this.el.close=this.close,this.options.closeSelector&&(this.el.closeBtns=Array.prototype.slice.call(this.el.querySelectorAll(this.options.closeSelector)),this.el.closeBtns.length||delete this.el.closeBtns),this.options.role&&this._validateModal(),this}},{key:"_initDom",value:function(e){this.options.role=e.getAttribute("role");var t=e.getAttribute("aria-modal");return this.options.modal&&"true"!==t&&(this._context.modalValue=t,e.setAttribute("aria-modal","true")),e.nextElementSibling?(this._context.ref=e.nextElementSibling,this._context.refPosition="next"):e.previousElementSibling?(this._context.ref=e.previousElementSibling,this._context.refPosition="previous"):(this._context.ref=e.parentElement,this._context.refPosition="parent"),this._context.hidden=e.getAttribute("aria-hidden"),e}},{key:"removeEventListener",value:function(){this.el.removeEventListener.apply(this.el,arguments)}},{key:"reset",value:function(){var e;"content"!==this.mode&&this._context.ref&&("parent"===this._context.refPosition?this._context.ref.appendChild(this.el):(e=this._context.next?"beforebegin":"afterend",this._context.ref.insertAdjacentElement(e,this.el)),this._context.modalValue?"false"===this._context.modalValue&&this.el.setAttribute("aria-modal",this._context.modalValue):this.el.removeAttribute("aria-modal"),this._context.hidden?this.el.setAttribute("aria-hidden",this._context.hidden):this.el.removeAttribute("aria-hidden"))}},{key:"_setDom",value:function(){this.options.modal&&"true"!==this.el.getAttribute("aria-modal")&&this.el.setAttribute("aria-modal","true"),document.body.appendChild(this.el)}},{key:"show",value:function(){this._context.ref&&this.el.parentNode!==document.body&&this._setDom(),s.unshift(this.el),this.returnValue="",this._bind(),this.options.opener=this.options.opener||a||document.activeElement,"svg"===this.options.opener.nodeName&&(this.options.opener=this.options.opener.parentNode),"false"!==this.el.getAttribute("aria-hidden")&&this.el.setAttribute("aria-hidden","false"),this._focus(),1===s.length&&this.options.modal&&!this.documentDisabled?this._disableDocument():this.documentDisabled&&this.options.content&&this._enableLayer()}},{key:"_unbind",value:function(){var t=this;this.el.removeEventListener("click",this._handleClick),this.el.removeEventListener("click",this._handleCancel),this.el.closeBtns&&this.el.closeBtns.forEach(function(e){e.removeEventListener("click",t._handleClose)})}},{key:"_validateModal",value:function(){var e=this.el.getAttribute("aria-label"),t=this.el.getAttribute("aria-describedby");if(!(e&&!(e.trim().length<0)||(e=this.el.querySelector("#"+this.el.getAttribute("aria-labelledby")))&&this.el.contains(e)))throw new Error('No title is present in the layer. Use the "data-label" attribute on the visible title or pass the label using the "label" key when creating the layer.');if("alertdialog"===this.options.role&&!t)throw new Error('"alertdialog" layer needs a description, use the "data-description" attribute on the text content of the layer to validate the layer.')}}]),r);function r(e,t){var i=this,n=r;if(!(i instanceof n))throw new TypeError("Cannot call a class as a function");if(this._handleCancel=this._handleCancel.bind(this),this._handleClick=this._handleClick.bind(this),this._handleClose=this._handleClose.bind(this),this.callbacks={},"string"==typeof(e=(t=arguments[1]||("object"===o(arguments[0])?arguments[0]:{}))!==arguments[0]?arguments[0]:void 0)&&((i=document.createElement("div")).innerHTML=e,e=i.firstChild),!e&&!t)throw new Error("No parameter passed.");void 0===t.modal&&(t.modal=!0),t.closeOnCancel||(t.closeOnCancel=!0),this.options=t,this._context={},this._init(e)}return document.body.addEventListener("keydown",function(e){s.length&&27===e.keyCode&&s[0].layer._dispatchEvent("cancel")}),document.body.addEventListener("focus",function(e){e.target!==document.body&&(a=e.target)},!0),t});
